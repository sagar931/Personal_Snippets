import zipfile
import os
import xml.etree.ElementTree as ET

def extract_sas_code_from_egp(egp_file_path):
    sas_code_blocks = []

    with zipfile.ZipFile(egp_file_path, 'r') as z:
        for file in z.namelist():
            # EGP files usually contain XMLs or "CodeNode" files with SAS code
            if file.endswith('.xml') or "Code" in file:
                with z.open(file) as f:
                    try:
                        tree = ET.parse(f)
                        root = tree.getroot()
                        for code_elem in root.iter('Code'):
                            if code_elem.text:
                                sas_code_blocks.append(code_elem.text.strip())
                    except ET.ParseError:
                        continue  # Skip files that are not valid XML

    return sas_code_blocks

# Example usage
egp_file_path = 'file-TuXvSy4QZtACtUy58doK2t.egp'
sas_code = extract_sas_code_from_egp(egp_file_path)

# Print extracted SAS code
for i, code in enumerate(sas_code, 1):
    print(f"\n--- SAS Code Block {i} ---\n{code}")

#---------------------------------------------------------------


import zipfile
import xml.etree.ElementTree as ET

def inspect_egp_file(egp_file_path):
    with zipfile.ZipFile(egp_file_path, 'r') as z:
        for file in z.namelist():
            print(f"\n--- Checking: {file} ---")
            if file.endswith('.xml') or 'Code' in file:
                try:
                    with z.open(file) as f:
                        tree = ET.parse(f)
                        root = tree.getroot()
                        for elem in root.iter():
                            if elem.text and elem.text.strip():
                                print(f"Tag: {elem.tag} | Sample: {elem.text.strip()[:100]}")
                                break  # just show first useful tag
                except ET.ParseError:
                    print("Skipped (not XML)")
                    continue

# Run this once to inspect
inspect_egp_file('file-8J8CTKKR6LzZipnbida1QS.egp')
